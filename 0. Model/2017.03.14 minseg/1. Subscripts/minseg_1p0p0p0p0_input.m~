%% [Input  ]: Model: General                                               
ui.mdl.label = 'minseg_M2V3_2017a';

ui.mdl.mode  = 0;
% 0: normal
% 1: external

ui.mdl.case  = 0;
%  ##: Case Description:      Plant:    Controller:    Command:
% -01: Clear board            Empty     Empty          Empty    % not yet implemented
% +00: Custom                 Custom    Custom         Custom
% +01: Motor characterization Hardware  FF  - v.motor  0 --> 10 [V]
% +02: Gyro bias calibration  Hardware  PID - w.motor  0 --> 00 [rad/s]
  
%% [Input  ]: Model: Plant                                                 

ui.plant.dynamics.mode        = 2;
% 0: actual hardware
% 1: simulated dynamics (non-linear)
% 2: simulated dynamics (    linear)

ui.plant.n.batteries          = 6; % [range: 0 - 6]

ui.plant.supply.mode          = 0;
% 0: 9.00 [V] (battery pack)
% 1: 4.50 [V] (usb cable) 
% Important: Do NOT set to usb power if actually using battery power.

% state [x]: initial condition
switch 1
  case 0; ui.plant.linear.stateIC = [0 0    0 0 0    0]';
  case 1; ui.plant.linear.stateIC = [0 0.03 0 0 0    0]';
  case 2; ui.plant.linear.stateIC = [0 0    0 0 pi/4 0]';
end
% x = [ theta     (angular position: wheel)          ]
%     [ phi.x     (angular position: body: x (pitch) ]
%     [ theta.dot (angular velocity: wheel)          ]
%     [ phi.x.dot (angular velocity: body: x (pitch) ]
%     [ phi.y     (angular position: body: y (yaw)   ]
%     [ phi.y.dot (angular velocity: body: y (yaw)   ]

%% [Input  ]: Model: Plant: Hardware                                       

ui.plant.hardware.calculation.phi.x.mode = 0; % [default: 0]
% 0: gyroscope
% 1: accelerometer            
% 2: gyroscope & accelerometer

ui.plant.hardware.calculation.phi.y.mode = 1; % [default: 1]
% 0: gyroscope                
% 1: wheel position
% 2: gyroscope & accelerometer

ui.plant.hardware.calculation.phi.z.mode = 0; % [default: 0]
% 0: gyroscope
% 1: accelerometer            
% 2: gyroscope & accelerometer

%% [Input  ]: Model: Controller: body.pitch.theta                          
% not yet implemented.

ui.ctrl.body.pitch.theta.mode = 0;
% #: mode:         input command:   [input command unit]:

%% [Input  ]: Model: Controller: motor.v                                   

ui.ctrl.motor_v.mode          = 2;
% #: mode:         [default]  input command:   [input command unit]:
% 0: feedForward              v.motor          [V]
% 1: PID                      w.motor          [rad/s]
% 2: SFR                      theta.motor      [rad]
%                             phi.y.motor      [rad]
% 3: SFR w/ RTS    [default]  theta.motor      [rad]
%                             phi.y.motor      [rad]

switch ui.ctrl.motor_v.mode
  
case 0 % feed forward (input: v.motor)
  ui.ctrl.motorDriver_v.cmd.tStart         (1,1) =  8;
  ui.ctrl.motorDriver_v.cmd.val.x          (1,1) = +3;
  ui.ctrl.motorDriver_v.cmd.val_norm.dx.max(1,1) = +inf;%0.01;
  ui.ctrl.motorDriver_v.cmd.val_norm.dx.min(1,1) = -inf;%0.01;
  
case 1 % PID          (input: w.motor)
  ui.ctrl.motorDriver_v.cmd.tStart         (1,1) =  0;
  ui.ctrl.motorDriver_v.cmd.val.x          (1,1) =  0.50 * 2*pi;
  ui.ctrl.motorDriver_v.cmd.val_norm.dx.max(1,1) = +0.10;
  ui.ctrl.motorDriver_v.cmd.val_norm.dx.min(1,1) = -inf;

case 2 % LQR          (input: theta, yaw)
  ui.ctrl.motorDriver_v.cmd.val.x          (1,1) =  1; %[0 or 1]
  % below: placeholders (don't actually matter.)
  ui.ctrl.motorDriver_v.cmd.tStart         (1,1) =  0;
  ui.ctrl.motorDriver_v.cmd.val_norm.dx.max(1,1) =  0;
  ui.ctrl.motorDriver_v.cmd.val_norm.dx.min(1,1) =  0;
end

load('ui.mat');
load('lqrGain.mat');

%% [Input  ]: Model: Serial                                                
ui.srl.x.bluetooth = 0;
% note: requires prior installation of bluetooth module into hardware.

ui.srl.mode.address.usb = 0;
% 0: left      usb port (2015 Macbook Pro)
% 1: left-rear usb port (2008 Macbook Pro)

% Note: Needs to be changed manually for external mode:
% Simulink: Configuration parameters: Hardware implementation: Host-board connection

ui.srl.T.decimation = 0; % [integer] [default: 0]
% Integer factor of board sample time (mdl.T.sample) 
%  in which to iterate serial processes.
% If 0, minimum possible value will be used.
% (Could be greater than 1 if combined size of reads/writes is sufficiently large.)

%% End










